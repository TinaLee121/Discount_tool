<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„ªæƒ ä»£ç¢¼é…ç½®ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 550px;
            gap: 20px;
        }

        .left-panel {
            min-width: 0;
        }

        .right-panel {
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 12px 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1565C0;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .form-group label .required {
            color: #f44336;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .hint {
            font-size: 12px;
            color: #999;
            margin-top: 3px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #0b7dda;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-outline {
            background: white;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-outline:hover {
            background: #f5f5f5;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .plan-card {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .plan-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .plan-badge {
            background: #4CAF50;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .remove-btn {
            background: #f44336;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        .remove-btn:hover {
            background: #da190b;
        }

        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            position: relative;
        }

        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .code-block-title {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .code-block pre {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 12px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #333;
            max-height: 300px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toggle-switch {
            display: inline-flex;
            gap: 10px;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .toggle-switch button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .toggle-switch button.active {
            background: white;
            color: #4CAF50;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* é è¦½è¦–çª—æ¨£å¼ */
        .preview-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .preview-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }

        .preview-scroll {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        /* å„ªæƒ åˆ¸å€å¡Šé è¦½ */
        .promo-section-preview {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .promo-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .promo-input-display {
            background: #3a3a3a;
            border: 1px solid #555;
            border-radius: 6px;
            padding: 10px;
            color: #999;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .promo-badge-display {
            display: inline-block;
            background: #a78bfa;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
        }

        .promo-check-display {
            background: rgba(34, 197, 94, 0.15);
            border-left: 3px solid #22c55e;
            padding: 8px 10px;
            border-radius: 4px;
            font-size: 12px;
            color: #22c55e;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }

        /* æ–¹æ¡ˆåˆ—è¡¨é è¦½ */
        .plan-list-preview {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
        }

        .plan-list-title {
            color: white;
            font-size: 13px;
            margin-bottom: 12px;
        }

        .plan-item-preview {
            background: #3a3a3a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .plan-badge-preview {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #a78bfa;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
        }

        .plan-content-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .plan-item-left {
            flex: 1;
            padding-top: 28px;
        }

        .plan-title-preview {
            color: white;
            font-size: 15px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .plan-price-preview {
            color: white;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-price-original {
            color: #999;
            font-size: 14px;
            text-decoration: line-through;
        }

        .plan-button-preview {
            background: #a78bfa;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
        }

        .empty-preview {
            color: #999;
            text-align: center;
            padding: 40px 20px;
            font-size: 14px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .right-panel {
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .plan-content-wrapper {
                flex-direction: column;
                align-items: stretch;
            }

            .plan-item-left {
                padding-top: 32px;
            }

            .plan-button-preview {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ« å„ªæƒ ä»£ç¢¼é…ç½®ç”Ÿæˆå™¨</h1>
        <p class="subtitle">å¿«é€Ÿç”¢ç”Ÿ Firebase Remote Config çš„ IAP è¨­å®šæª”</p>

        <div class="main-content">
            <!-- å·¦å´ç·¨è¼¯å€ -->
            <div class="left-panel">
                <!-- åˆ‡æ›æŒ‰éˆ• -->
                <div class="toggle-switch">
                    <button class="active" onclick="switchSection('plan')">åŸåƒ¹æ–¹æ¡ˆè¨­å®š</button>
                    <button onclick="switchSection('promo')">å„ªæƒ æ–¹æ¡ˆè¨­å®š</button>
                </div>

                <!-- åŸåƒ¹æ–¹æ¡ˆè¨­å®š -->
                <div id="plan-section" class="section-wrapper">
                    <div class="section">
                        <div class="section-title">
                            åŸåƒ¹æ–¹æ¡ˆè¨­å®š (iapPlanInfoList)
                            <button class="btn btn-primary" onclick="addPlan()" style="float: right; font-size: 14px;">+ æ–°å¢æ–¹æ¡ˆ</button>
                        </div>

                        <div class="info-box">
                            ğŸ’¡ è¨­å®šç”¨æˆ¶åœ¨è¼¸å…¥å„ªæƒ ç¢¼å‰æœƒçœ‹åˆ°çš„åŸåƒ¹æ–¹æ¡ˆ
                        </div>

                        <div id="plan-list"></div>

                        <div class="code-block">
                            <div class="code-block-header">
                                <span class="code-block-title">ç”Ÿæˆçš„ JSON</span>
                                <button class="btn btn-outline" onclick="copyAllJSON('plan')">ğŸ“‹ ä¸€éµè¤‡è£½</button>
                            </div>
                            <pre id="plan-output">[]</pre>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="downloadPlanJSON()">ğŸ’¾ ä¸‹è¼‰ JSON</button>
                            <button class="btn btn-danger" onclick="clearPlans()">æ¸…ç©º</button>
                        </div>
                    </div>
                </div>

                <!-- å„ªæƒ æ–¹æ¡ˆè¨­å®š -->
                <div id="promo-section" class="section-wrapper" style="display: none;">
                    <div class="section">
                        <div class="section-title">
                            å„ªæƒ æ–¹æ¡ˆè¨­å®š (iapPromoPlanInfoList)
                            <button class="btn btn-primary" onclick="addPromo()" style="float: right; font-size: 14px;">+ æ–°å¢å„ªæƒ ç¢¼</button>
                        </div>

                        <div class="info-box">
                            ğŸ’¡ è¨­å®šå„ªæƒ ç¢¼åŠå°æ‡‰çš„å„ªæƒ æ–¹æ¡ˆ,ç”¨æˆ¶è¼¸å…¥å„ªæƒ ç¢¼å¾Œæœƒçœ‹åˆ°é€™äº›æ–¹æ¡ˆ
                        </div>

                        <div id="promo-list"></div>

                        <div class="code-block">
                            <div class="code-block-header">
                                <span class="code-block-title">ç”Ÿæˆçš„ JSON</span>
                                <button class="btn btn-outline" onclick="copyAllJSON('promo')">ğŸ“‹ ä¸€éµè¤‡è£½</button>
                            </div>
                            <pre id="promo-output">[]</pre>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="downloadPromoJSON()">ğŸ’¾ ä¸‹è¼‰ JSON</button>
                            <button class="btn btn-danger" onclick="clearPromos()">æ¸…ç©º</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´é è¦½å€ -->
            <div class="right-panel">
                <div class="preview-panel">
                    <div class="preview-title">ğŸ“± å³æ™‚é è¦½</div>
                    
                    <div class="preview-scroll">
                        <!-- åŸåƒ¹æ–¹æ¡ˆé è¦½ -->
                        <div id="plan-preview-area">
                            <div class="plan-list-preview">
                                <div class="plan-list-title">é¸æ“‡é©åˆæ‚¨çš„æ–¹æ¡ˆ</div>
                                <div id="plan-preview-list">
                                    <div class="empty-preview">è«‹æ–°å¢æ–¹æ¡ˆé–‹å§‹è¨­å®š</div>
                                </div>
                            </div>
                        </div>

                        <!-- å„ªæƒ æ–¹æ¡ˆé è¦½ -->
                        <div id="promo-preview-area" style="display: none;">
                            <div class="promo-section-preview">
                                <div class="promo-title">å„ªæƒ åˆ¸</div>
                                <div class="promo-input-display">è«‹è¼¸å…¥å„ªæƒ ç¢¼</div>
                                <div id="promo-code-display"></div>
                            </div>
                            
                            <div class="plan-list-preview">
                                <div class="plan-list-title">é¸æ“‡é©åˆæ‚¨çš„æ–¹æ¡ˆ</div>
                                <div id="promo-preview-list">
                                    <div class="empty-preview">è«‹æ–°å¢å„ªæƒ æ–¹æ¡ˆé–‹å§‹è¨­å®š</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // è³‡æ–™å„²å­˜
        let plans = [];
        let promos = [];
        let planCounter = 0;
        let promoCounter = 0;
        let currentSection = 'plan';

        // åˆå§‹åŒ–:é è¨­åŠ å…¥ä¸€å€‹æ–¹æ¡ˆ
        function init() {
            addPlan();
            addPromo();
        }

        // åˆ‡æ›å€å¡Š
        function switchSection(section) {
            currentSection = section;
            document.querySelectorAll('.toggle-switch button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.getElementById('plan-section').style.display = section === 'plan' ? 'block' : 'none';
            document.getElementById('promo-section').style.display = section === 'promo' ? 'block' : 'none';
            
            document.getElementById('plan-preview-area').style.display = section === 'plan' ? 'block' : 'none';
            document.getElementById('promo-preview-area').style.display = section === 'promo' ? 'block' : 'none';
        }

        // é‡æ–°ç·¨è™Ÿæ–¹æ¡ˆ
        function reindexPlans() {
            plans.forEach((plan, index) => {
                plan.displayId = index + 1;
            });
        }

        // === åŸåƒ¹æ–¹æ¡ˆç›¸é—œ ===
        function addPlan() {
            const id = ++planCounter;
            const plan = {
                id,
                displayId: plans.length + 1,
                iosProductID: '',
                androidProductID: '',
                androidBasePlanID: '',
                iapButtonUrl: '',
                iapTextLeftUp: '',
                iapTextUp: '',
                iapTextDown: ''
            };
            plans.push(plan);
            renderPlans();
            updatePlanPreview();
        }

        function renderPlans() {
            const container = document.getElementById('plan-list');
            container.innerHTML = plans.map(plan => `
                <div class="plan-card">
                    <div class="plan-card-header">
                        <span class="plan-badge">æ–¹æ¡ˆ ${plan.displayId}</span>
                        <button class="remove-btn" onclick="removePlan(${plan.id})">Ã—</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>iOS Product ID <span class="required">*</span></label>
                            <input type="text" value="${plan.iosProductID}" 
                                   oninput="updatePlan(${plan.id}, 'iosProductID', this.value)"
                                   placeholder="">
                        </div>
                        
                        <div class="form-group">
                            <label>Android Product ID <span class="required">*</span></label>
                            <input type="text" value="${plan.androidProductID}" 
                                   oninput="updatePlan(${plan.id}, 'androidProductID', this.value)"
                                   placeholder="">
                        </div>
                        
                        <div class="form-group">
                            <label>Android Base Plan ID <span class="required">*</span></label>
                            <input type="text" value="${plan.androidBasePlanID}" 
                                   oninput="updatePlan(${plan.id}, 'androidBasePlanID', this.value)"
                                   placeholder="">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>IAP æŒ‰éˆ•é€£çµ</label>
                            <input type="text" value="${plan.iapButtonUrl}" 
                                   oninput="updatePlan(${plan.id}, 'iapButtonUrl', this.value)"
                                   placeholder="https://test.cmoney.tw/app/ItemContent.aspx?id=4906">
                        </div>
                        
                        <div class="form-group">
                            <label>æ¨™ç±¤æ–‡å­— (å·¦ä¸Šè§’) ğŸ“±</label>
                            <input type="text" value="${plan.iapTextLeftUp}" 
                                   oninput="updatePlan(${plan.id}, 'iapTextLeftUp', this.value)"
                                   placeholder="">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>æ–¹æ¡ˆåç¨± ğŸ“±</label>
                            <input type="text" value="${plan.iapTextUp}" 
                                   oninput="updatePlan(${plan.id}, 'iapTextUp', this.value)"
                                   placeholder="">
                        </div>
                        
                        <div class="form-group">
                            <label>åƒ¹æ ¼é¡¯ç¤º ğŸ“±</label>
                            <input type="text" value="${plan.iapTextDown}" 
                                   oninput="updatePlan(${plan.id}, 'iapTextDown', this.value)"
                                   placeholder="">
                        </div>
                    </div>
                </div>
            `).join('');
            updatePlanOutput();
        }

        function updatePlan(id, field, value) {
            const plan = plans.find(p => p.id === id);
            if (plan) {
                plan[field] = value;
                updatePlanOutput();
                updatePlanPreview();
            }
        }

        function removePlan(id) {
            plans = plans.filter(p => p.id !== id);
            reindexPlans();
            renderPlans();
            updatePlanPreview();
        }

        function updatePlanOutput() {
            const output = plans.map(plan => ({
                iosProductID: plan.iosProductID,
                androidProductID: plan.androidProductID,
                androidBasePlanID: plan.androidBasePlanID,
                iapButtonUrl: plan.iapButtonUrl,
                iapTextLeftUp: plan.iapTextLeftUp,
                iapTextUp: plan.iapTextUp,
                iapTextDown: plan.iapTextDown
            }));
            document.getElementById('plan-output').textContent = JSON.stringify(output, null, 2);
        }

        function updatePlanPreview() {
            const container = document.getElementById('plan-preview-list');
            
            if (plans.length === 0 || plans.every(p => !p.iapTextLeftUp && !p.iapTextUp && !p.iapTextDown)) {
                container.innerHTML = '<div class="empty-preview">è«‹æ–°å¢æ–¹æ¡ˆé–‹å§‹è¨­å®š</div>';
                return;
            }
            
            container.innerHTML = plans.map(plan => {
                // å¦‚æœéƒ½æ²’æœ‰å…§å®¹å°±ä¸é¡¯ç¤º
                if (!plan.iapTextLeftUp && !plan.iapTextUp && !plan.iapTextDown) {
                    return '';
                }
                
                return `
                    <div class="plan-item-preview">
                        ${plan.iapTextLeftUp ? `<div class="plan-badge-preview">${plan.iapTextLeftUp}</div>` : ''}
                        <div class="plan-content-wrapper">
                            <div class="plan-item-left">
                                ${plan.iapTextUp ? `<div class="plan-title-preview">${plan.iapTextUp}</div>` : ''}
                                ${plan.iapTextDown ? `<div class="plan-price-preview">${plan.iapTextDown}</div>` : ''}
                            </div>
                            <div class="plan-button-preview">å³åˆ»è³¼è²·</div>
                        </div>
                    </div>
                `;
            }).join('') || '<div class="empty-preview">è«‹è¼¸å…¥æ–¹æ¡ˆè³‡è¨Š</div>';
        }

        function clearPlans() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰åŸåƒ¹æ–¹æ¡ˆå—ï¼Ÿ')) return;
            plans = [];
            planCounter = 0;
            addPlan();
        }

        function downloadPlanJSON() {
            const data = JSON.parse(document.getElementById('plan-output').textContent);
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `iapPlanInfoList-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('âœ… JSON æª”æ¡ˆå·²ä¸‹è¼‰');
        }

        // é‡æ–°ç·¨è™Ÿå„ªæƒ æ–¹æ¡ˆ
        function reindexPromos() {
            promos.forEach((promo, index) => {
                promo.displayId = index + 1;
            });
        }

        // === å„ªæƒ æ–¹æ¡ˆç›¸é—œ ===
        function addPromo() {
            const id = ++promoCounter;
            const promo = {
                id,
                displayId: promos.length + 1,
                code: '',
                planInfoList: [{
                    iosOriginalProductID: '',
                    iosPromoProductID: '',
                    androidOriginalBasePlanID: '',
                    androidPromoBasePlanID: '',
                    androidOfferID: '',
                    iapTextLeftUp: '',
                    iapTextUp: '',
                    iapTextDown: '',
                    iapTitleAndPriceControl: 2
                }]
            };
            promos.push(promo);
            renderPromos();
            updatePromoPreview();
        }

        function renderPromos() {
            const container = document.getElementById('promo-list');
            container.innerHTML = promos.map(promo => `
                <div class="plan-card">
                    <div class="plan-card-header">
                        <span class="plan-badge">å„ªæƒ ç¢¼ ${promo.displayId}</span>
                        <button class="remove-btn" onclick="removePromo(${promo.id})">Ã—</button>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>å„ªæƒ ç¢¼ (å¤§å¯«) <span class="required">*</span></label>
                        <input type="text" value="${promo.code}" 
                               oninput="updatePromoCode(${promo.id}, this.value.toUpperCase())"
                               placeholder="TEST1" style="text-transform: uppercase;">
                        <span class="hint">å„ªæƒ ç¢¼å¿…é ˆå…¨å¤§å¯«</span>
                    </div>

                    ${promo.planInfoList.map((plan, index) => `
                        <div style="background: white; padding: 15px; border-radius: 4px; margin-bottom: 10px; border: 1px solid #e0e0e0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: #4CAF50;">å°æ‡‰æ–¹æ¡ˆ ${index + 1}</strong>
                                ${promo.planInfoList.length > 1 ? `
                                    <button class="remove-btn" style="width: 24px; height: 24px; font-size: 16px;" 
                                            onclick="removePromoPlan(${promo.id}, ${index})">Ã—</button>
                                ` : ''}
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>iOS åŸåƒ¹ Product ID <span class="required">*</span></label>
                                    <input type="text" value="${plan.iosOriginalProductID}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'iosOriginalProductID', this.value)">
                                </div>
                                
                                <div class="form-group">
                                    <label>iOS å„ªæƒ  Product ID <span class="required">*</span></label>
                                    <input type="text" value="${plan.iosPromoProductID}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'iosPromoProductID', this.value)">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Android åŸåƒ¹ Base Plan ID <span class="required">*</span></label>
                                    <input type="text" value="${plan.androidOriginalBasePlanID}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'androidOriginalBasePlanID', this.value)">
                                </div>
                                
                                <div class="form-group">
                                    <label>Android å„ªæƒ  Base Plan ID <span class="required">*</span></label>
                                    <input type="text" value="${plan.androidPromoBasePlanID}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'androidPromoBasePlanID', this.value)">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Android Offer ID</label>
                                    <input type="text" value="${plan.androidOfferID}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'androidOfferID', this.value)"
                                           placeholder="">
                                </div>
                                
                                <div class="form-group">
                                    <label>åƒ¹æ ¼é¡¯ç¤ºæ§åˆ¶</label>
                                    <select onchange="updatePromoPlan(${promo.id}, ${index}, 'iapTitleAndPriceControl', parseInt(this.value))">
                                        <option value="1" ${plan.iapTitleAndPriceControl === 1 ? 'selected' : ''}>1 - å¾Œå°åƒ¹æ ¼</option>
                                        <option value="2" ${plan.iapTitleAndPriceControl === 2 ? 'selected' : ''}>2 - è‡ªè¨‚æ–‡å­—</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>æ¨™ç±¤æ–‡å­— (å·¦ä¸Šè§’) ğŸ“±</label>
                                    <input type="text" value="${plan.iapTextLeftUp}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'iapTextLeftUp', this.value)"
                                           placeholder="">
                                </div>
                                
                                <div class="form-group">
                                    <label>æ–¹æ¡ˆåç¨± ğŸ“±</label>
                                    <input type="text" value="${plan.iapTextUp}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'iapTextUp', this.value)"
                                           placeholder="">
                                </div>
                                
                                <div class="form-group">
                                    <label>åƒ¹æ ¼é¡¯ç¤º ğŸ“±</label>
                                    <input type="text" value="${plan.iapTextDown}" 
                                           oninput="updatePromoPlan(${promo.id}, ${index}, 'iapTextDown', this.value)"
                                           placeholder="">
                                </div>
                            </div>
                        </div>
                    `).join('')}
                    
                    <button class="btn btn-outline" onclick="addPromoPlan(${promo.id})" style="width: 100%;">+ æ–°å¢å°æ‡‰æ–¹æ¡ˆ</button>
                </div>
            `).join('');
            updatePromoOutput();
        }

        function updatePromo(id, field, value) {
            const promo = promos.find(p => p.id === id);
            if (promo) {
                promo[field] = value;
                updatePromoOutput();
                updatePromoPreview();
            }
        }

        function updatePromoCode(id, value) {
            const promo = promos.find(p => p.id === id);
            if (promo) {
                promo.code = value;
                updatePromoOutput();
                // ä¸å‘¼å« updatePromoPreview(),æ‰€ä»¥ä¸æœƒæ›´æ–°é è¦½
            }
        }

        function updatePromoPlan(promoId, planIndex, field, value) {
            const promo = promos.find(p => p.id === promoId);
            if (promo && promo.planInfoList[planIndex]) {
                promo.planInfoList[planIndex][field] = value;
                updatePromoOutput();
                updatePromoPreview();
            }
        }

        function addPromoPlan(promoId) {
            const promo = promos.find(p => p.id === promoId);
            if (promo) {
                promo.planInfoList.push({
                    iosOriginalProductID: '',
                    iosPromoProductID: '',
                    androidOriginalBasePlanID: '',
                    androidPromoBasePlanID: '',
                    androidOfferID: '',
                    iapTextLeftUp: '',
                    iapTextUp: '',
                    iapTextDown: '',
                    iapTitleAndPriceControl: 2
                });
                renderPromos();
            }
        }

        function removePromoPlan(promoId, planIndex) {
            const promo = promos.find(p => p.id === promoId);
            if (promo && promo.planInfoList.length > 1) {
                promo.planInfoList.splice(planIndex, 1);
                renderPromos();
            }
        }

        function removePromo(id) {
            promos = promos.filter(p => p.id !== id);
            reindexPromos();
            renderPromos();
            updatePromoPreview();
        }

        function updatePromoOutput() {
            const output = promos.map(promo => ({
                code: promo.code,
                planInfoList: promo.planInfoList.map(plan => ({
                    iosOriginalProductID: plan.iosOriginalProductID,
                    iosPromoProductID: plan.iosPromoProductID,
                    androidOriginalBasePlanID: plan.androidOriginalBasePlanID,
                    androidPromoBasePlanID: plan.androidPromoBasePlanID,
                    androidOfferID: plan.androidOfferID,
                    iapTextLeftUp: plan.iapTextLeftUp,
                    iapTextUp: plan.iapTextUp,
                    iapTextDown: plan.iapTextDown,
                    iapTitleAndPriceControl: plan.iapTitleAndPriceControl
                }))
            }));
            document.getElementById('promo-output').textContent = JSON.stringify(output, null, 2);
        }

        function updatePromoPreview() {
            // æ›´æ–°å„ªæƒ ç¢¼é¡¯ç¤º
            const codeDisplay = document.getElementById('promo-code-display');
            const firstPromo = promos[0];
            if (firstPromo && firstPromo.code) {
                codeDisplay.innerHTML = `
                    <div class="promo-badge-display">${firstPromo.code}</div>
                    
                    </div>
                `;
            } else {
                codeDisplay.innerHTML = '';
            }

            // æ›´æ–°æ–¹æ¡ˆåˆ—è¡¨
            const container = document.getElementById('promo-preview-list');
            
            const hasContent = promos.some(promo => 
                promo.planInfoList.some(plan => 
                    plan.iapTextLeftUp || plan.iapTextUp || plan.iapTextDown
                )
            );
            
            if (!hasContent) {
                container.innerHTML = '<div class="empty-preview">è«‹æ–°å¢å„ªæƒ æ–¹æ¡ˆé–‹å§‹è¨­å®š</div>';
                return;
            }
            
            container.innerHTML = promos.flatMap(promo => 
                promo.planInfoList.map(plan => {
                    // å¦‚æœéƒ½æ²’æœ‰å…§å®¹å°±ä¸é¡¯ç¤º
                    if (!plan.iapTextLeftUp && !plan.iapTextUp && !plan.iapTextDown) {
                        return '';
                    }
                    
                    return `
                        <div class="plan-item-preview">
                            ${plan.iapTextLeftUp ? `<div class="plan-badge-preview">${plan.iapTextLeftUp}</div>` : ''}
                            <div class="plan-content-wrapper">
                                <div class="plan-item-left">
                                    ${plan.iapTextUp ? `<div class="plan-title-preview">${plan.iapTextUp}</div>` : ''}
                                    ${plan.iapTextDown ? `<div class="plan-price-preview">${plan.iapTextDown}</div>` : ''}
                                </div>
                                <div class="plan-button-preview">å³åˆ»è³¼è²·</div>
                            </div>
                        </div>
                    `;
                })
            ).join('') || '<div class="empty-preview">è«‹è¼¸å…¥æ–¹æ¡ˆè³‡è¨Š</div>';
        }

        function clearPromos() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å„ªæƒ æ–¹æ¡ˆå—ï¼Ÿ')) return;
            promos = [];
            promoCounter = 0;
            addPromo();
        }

        function downloadPromoJSON() {
            const data = JSON.parse(document.getElementById('promo-output').textContent);
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `iapPromoPlanInfoList-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('âœ… JSON æª”æ¡ˆå·²ä¸‹è¼‰');
        }

        // === é€šç”¨åŠŸèƒ½ ===
        function copyAllJSON(type) {
            const elementId = type === 'plan' ? 'plan-output' : 'promo-output';
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                showToast('âœ… å·²è¤‡è£½ JSON åˆ°å‰ªè²¼ç°¿');
            });
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>